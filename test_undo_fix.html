<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solitaire Undo Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-area {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ¦„ Solitaire Undo Test</h1>
    
    <div class="test-area">
        <h2>Test SenaryolarÄ±</h2>
        <div class="status info">
            <strong>Undo Ã–zellikleri:</strong>
            <ul>
                <li>âœ… Stock'tan kart Ã§ekme/geri alma (draw/reset)</li>
                <li>âœ… Tableau'dan tableau'ya kart taÅŸÄ±ma</li>
                <li>âœ… Tableau'dan foundation'a kart taÅŸÄ±ma</li>
                <li>âœ… Waste'ten tableau/foundation'a kart taÅŸÄ±ma</li>
                <li>âœ… Reveal edilen kartlarÄ±n durumu</li>
                <li>âœ… Skor ve hamle sayÄ±sÄ± geri alma</li>
                <li>âœ… Tek undo limiti (bir kez kullanÄ±labilir)</li>
            </ul>
        </div>
        
        <div class="status success">
            <strong>DÃ¼zeltmeler:</strong>
            <ul>
                <li>âœ… recordMove fonksiyonu previousState kaydediyor</li>
                <li>âœ… undoMove fonksiyonu tÃ¼m state'i geri yÃ¼klÃ¼yor</li>
                <li>âœ… undoUsed flag'i ile tek undo kontrolÃ¼</li>
                <li>âœ… Her yeni hamlede undo tekrar kullanÄ±labilir</li>
                <li>âœ… Tableau kartlarÄ±nÄ±n reveal durumu korunuyor</li>
            </ul>
        </div>
        
        <h3>Test AdÄ±mlarÄ±:</h3>
        <ol>
            <li>Solitaire oyununu aÃ§: <a href="http://localhost:8000/solitaire/" target="_blank">http://localhost:8000/solitaire/</a></li>
            <li>Stock'tan kart Ã§ek ve undo yap</li>
            <li>Tableau'dan baÅŸka tableau'ya kart taÅŸÄ± ve undo yap</li>
            <li>Alttan kart al (reveal olacak) ve undo yap</li>
            <li>Foundation'a kart koy ve undo yap</li>
            <li>Ä°kinci kez undo yapmayÄ± dene (Ã§alÄ±ÅŸmamalÄ±)</li>
            <li>Yeni hamle yap ve tekrar undo dene (Ã§alÄ±ÅŸmalÄ±)</li>
        </ol>
        
        <button onclick="window.open('http://localhost:8000/solitaire/', '_blank')">
            ğŸ® Solitaire'i AÃ§
        </button>
        
        <button onclick="testUndo()">
            ğŸ§ª Console'da Test Et
        </button>
    </div>
    
    <div class="test-area">
        <h2>Kod DeÄŸiÅŸiklikleri</h2>
        <pre style="background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto;">
// 1. recordMove fonksiyonu gÃ¼ncellendi:
function recordMove(moveType, from, to, cards, additionalInfo = {}) {
    // Reset undo flag when making a new move
    game.undoUsed = false;
    
    // Save the state BEFORE the move for undo
    const previousState = {
        stock: game.stock.map(c => ({...c})),
        waste: game.waste.map(c => ({...c})),
        foundations: game.foundations.map(f => f.map(c => ({...c}))),
        tableau: game.tableau.map(t => t.map(c => ({...c}))),
        score: game.score,
        moves: game.moves
    };
    
    const move = {
        type: moveType,
        from: from,
        to: to,
        cards: cards.map(c => ({...c})),
        timestamp: Date.now(),
        moveNumber: game.moves + 1,
        previousState: previousState, // Store complete previous state
        ...additionalInfo
    };
    // ...
}

// 2. undoMove fonksiyonu tamamen yenilendi:
function undoMove() {
    if (!game.moveHistory || game.moveHistory.length === 0) {
        console.log('No moves to undo');
        return;
    }
    
    // Check if undo was already used (only allow one undo)
    if (game.undoUsed) {
        console.log('Undo already used. Make a new move to reset undo.');
        return;
    }
    
    // Get the last move
    const lastMove = game.moveHistory.pop();
    
    // Restore the previous state completely
    if (lastMove.previousState) {
        // Deep copy the previous state
        game.stock = lastMove.previousState.stock.map(c => ({...c}));
        game.waste = lastMove.previousState.waste.map(c => ({...c}));
        game.foundations = lastMove.previousState.foundations.map(f => f.map(c => ({...c})));
        game.tableau = lastMove.previousState.tableau.map(t => t.map(c => ({...c})));
        game.score = lastMove.previousState.score;
        game.moves = lastMove.previousState.moves;
        
        // Mark undo as used
        game.undoUsed = true;
        
        // Update UI and re-render
        document.getElementById('moves').textContent = game.moves;
        document.getElementById('score').textContent = game.score;
        render();
        saveGameState();
    }
}
        </pre>
    </div>
    
    <script>
        function testUndo() {
            console.log('Undo test baÅŸlatÄ±ldÄ±...');
            console.log('LÃ¼tfen solitaire oyununu aÃ§Ä±n ve:');
            console.log('1. Bir hamle yapÄ±n');
            console.log('2. Undo butonuna tÄ±klayÄ±n');
            console.log('3. Hamlenin geri alÄ±ndÄ±ÄŸÄ±nÄ± kontrol edin');
            console.log('4. Tekrar undo yapmayÄ± deneyin (Ã§alÄ±ÅŸmamalÄ±)');
            console.log('5. Yeni bir hamle yapÄ±n ve tekrar undo deneyin (Ã§alÄ±ÅŸmalÄ±)');
            
            alert('Test talimatlarÄ± console\'da gÃ¶rÃ¼ntÃ¼lendi. Solitaire oyununu aÃ§Ä±n ve test edin.');
        }
    </script>
</body>
</html>