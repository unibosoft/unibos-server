<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Undo Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #2a6f2e;
            color: white;
        }
        .card {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .fix-item {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-item {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .code-block {
            background: #f4f4f5;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #e55a2b;
        }
        .important {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            color: #78350f;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸƒ Solitaire Stock Undo Fix - Test Page</h1>
    
    <div class="card">
        <h2>ğŸ”§ YapÄ±lan DÃ¼zeltmeler</h2>
        
        <div class="fix-item">
            <strong>1. recordMove Fonksiyonu:</strong>
            <p>â€¢ previousState artÄ±k hareket YAPILMADAN Ã–NCE kaydediliyor</p>
            <p>â€¢ TÃ¼m oyun durumu (stock, waste, foundations, tableau) deep copy ile saklanÄ±yor</p>
            <p>â€¢ undoUsed flag'i her yeni harekette resetleniyor</p>
        </div>
        
        <div class="fix-item">
            <strong>2. handleStockClick Fonksiyonu:</strong>
            <p>â€¢ Stock'tan kart Ã§ekmeden Ã–NCE state kaydediliyor</p>
            <p>â€¢ Ã‡ekilecek kartlar Ã¶nceden belirleniyor</p>
            <p>â€¢ Waste'teki kart sayÄ±sÄ± da kaydediliyor</p>
        </div>
        
        <div class="fix-item">
            <strong>3. Drag & Drop Ä°ÅŸlemleri:</strong>
            <p>â€¢ recordMove artÄ±k hareket yapÄ±lmadan Ã–NCE Ã§aÄŸrÄ±lÄ±yor</p>
            <p>â€¢ Reveal edilecek kartlarÄ±n durumu kaydediliyor</p>
            <p>â€¢ Double-click auto-move'da da aynÄ± dÃ¼zeltme yapÄ±ldÄ±</p>
        </div>
        
        <div class="fix-item">
            <strong>4. undoMove Fonksiyonu:</strong>
            <p>â€¢ previousState kullanarak tÃ¼m oyunu Ã¶nceki duruma dÃ¶ndÃ¼rÃ¼yor</p>
            <p>â€¢ Tek undo limiti uygulanÄ±yor (undoUsed flag)</p>
            <p>â€¢ Stock, waste, foundations ve tableau tamamen restore ediliyor</p>
        </div>
    </div>
    
    <div class="card">
        <h2>âœ… Test SenaryolarÄ±</h2>
        
        <div class="test-item">
            <strong>Test 1: Stock'tan 3'lÃ¼ Kart Ã‡ekme</strong>
            <ol>
                <li>Stock'a tÄ±klayarak 3 kart Ã§ek</li>
                <li>Undo butonuna bas</li>
                <li>âœ… 3 kart stock'a geri dÃ¶nmeli, waste Ã¶nceki durumda olmalÄ±</li>
            </ol>
        </div>
        
        <div class="test-item">
            <strong>Test 2: Birden Fazla 3'lÃ¼ Ã‡ekme</strong>
            <ol>
                <li>Stock'a 3 kez tÄ±kla (9 kart Ã§ek)</li>
                <li>Undo butonuna bas</li>
                <li>âœ… Son 3 kart geri dÃ¶nmeli, Ã¶nceki 6 kart waste'te kalmalÄ±</li>
            </ol>
        </div>
        
        <div class="test-item">
            <strong>Test 3: Stock Reset (Waste'i Stock'a Geri DÃ¶ndÃ¼rme)</strong>
            <ol>
                <li>TÃ¼m stock'u bitir (waste dolu olacak)</li>
                <li>BoÅŸ stock'a tÄ±kla (reset yapÄ±lacak)</li>
                <li>Undo butonuna bas</li>
                <li>âœ… Waste tekrar dolu olmalÄ±, stock boÅŸ olmalÄ±</li>
            </ol>
        </div>
        
        <div class="test-item">
            <strong>Test 4: Tableau KartÄ± Reveal</strong>
            <ol>
                <li>KapalÄ± kart Ã¼zerindeki aÃ§Ä±k kartÄ± baÅŸka yere taÅŸÄ±</li>
                <li>Alt kart otomatik aÃ§Ä±lacak</li>
                <li>Undo butonuna bas</li>
                <li>âœ… Kart eski yerine dÃ¶nmeli, alt kart tekrar kapalÄ± olmalÄ±</li>
            </ol>
        </div>
        
        <div class="test-item">
            <strong>Test 5: Tek Undo Limiti</strong>
            <ol>
                <li>Herhangi bir hamle yap</li>
                <li>Undo butonuna bas (Ã§alÄ±ÅŸacak)</li>
                <li>Tekrar undo butonuna bas</li>
                <li>âŒ Ä°kinci undo Ã§alÄ±ÅŸmamalÄ±</li>
                <li>Yeni bir hamle yap</li>
                <li>Undo butonuna bas</li>
                <li>âœ… Undo tekrar Ã§alÄ±ÅŸmalÄ±</li>
            </ol>
        </div>
    </div>
    
    <div class="important">
        <h3>âš ï¸ Ã–nemli Notlar:</h3>
        <ul>
            <li>Undo sadece BÄ°R KEZ kullanÄ±labilir</li>
            <li>Yeni hamle yapÄ±ldÄ±ÄŸÄ±nda undo tekrar aktif olur</li>
            <li>TÃ¼m kart hareketleri (stock, tableau, foundation) undo destekliyor</li>
            <li>Reveal edilen kartlar da undo ile eski durumuna dÃ¶ner</li>
        </ul>
    </div>
    
    <div class="card">
        <h2>ğŸš€ Testi BaÅŸlat</h2>
        <p>Solitaire oyununu aÃ§Ä±p yukarÄ±daki test senaryolarÄ±nÄ± deneyin:</p>
        
        <button onclick="window.open('http://localhost:8000/solitaire/', '_blank')">
            ğŸ® Solitaire'i AÃ§
        </button>
        
        <button onclick="showTestInstructions()">
            ğŸ“‹ Test TalimatlarÄ±nÄ± GÃ¶ster
        </button>
    </div>
    
    <div class="card">
        <h2>ğŸ“ Kod DeÄŸiÅŸiklikleri Ã–zeti</h2>
        
        <div class="code-block">
// Ã–NCEKÄ° SORUN:
// recordMove fonksiyonu hareket YAPILDIKTAN SONRA Ã§aÄŸrÄ±lÄ±yordu
// Bu yÃ¼zden previousState yanlÄ±ÅŸ kaydediliyordu

// YENÄ° Ã‡Ã–ZÃœM:
// 1. Hareket yapÄ±lacaÄŸÄ±nÄ± belirle
// 2. Mevcut state'i kaydet (recordMove ile)
// 3. Hareketi yap
// 4. UI'Ä± gÃ¼ncelle

// Ã–rnek: Stock'tan kart Ã§ekme
if (game.stock.length > 0) {
    // Ã–NCE: Ã‡ekilecek kartlarÄ± belirle
    const cardsToDrawCount = Math.min(3, game.stock.length);
    
    // recordMove ile mevcut state'i kaydet
    moveInfo = recordMove('draw', 'stock', 'waste', cardsInfo, {
        cardsDrawn: cardsToDrawCount,
        wasteCountBefore: game.waste.length
    });
    
    // SONRA: KartlarÄ± gerÃ§ekten Ã§ek
    for (let i = 0; i < cardsToDrawCount; i++) {
        const card = game.stock.pop();
        card.faceUp = true;
        game.waste.push(card);
    }
}
        </div>
    </div>
    
    <script>
        function showTestInstructions() {
            const instructions = `
TEST TALÄ°MATLARI:

1. STOCK UNDO TESTÄ°:
   - Stock'a tÄ±klayÄ±n (3 kart aÃ§Ä±lacak)
   - Undo'ya basÄ±n
   - Kartlar geri dÃ¶nmeli

2. Ã‡OK ADIMLI STOCK TESTÄ°:
   - Stock'a 5-6 kez tÄ±klayÄ±n
   - Undo'ya basÄ±n
   - Sadece son 3'lÃ¼ geri dÃ¶nmeli

3. TABLEAU REVEAL TESTÄ°:
   - KapalÄ± kart Ã¼zerindeki kartÄ± taÅŸÄ±yÄ±n
   - Alt kart aÃ§Ä±lacak
   - Undo'ya basÄ±n
   - Alt kart tekrar kapanmalÄ±

4. TEK UNDO LÄ°MÄ°TÄ°:
   - Bir hamle yapÄ±n
   - Undo (Ã§alÄ±ÅŸacak)
   - Tekrar undo (Ã§alÄ±ÅŸmayacak)
   - Yeni hamle
   - Undo (tekrar Ã§alÄ±ÅŸacak)
            `;
            
            alert(instructions);
        }
    </script>
</body>
</html>