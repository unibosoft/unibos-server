<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Limit Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            color: white;
        }
        .card {
            background: white;
            color: #333;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .error {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .warning {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .code {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            border: 1px solid #dee2e6;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .before { background: #ffebee; }
        .after { background: #e8f5e9; }
    </style>
</head>
<body>
    <h1>âš¡ Rate Limit Fix - API Optimizasyonu</h1>
    
    <div class="card">
        <h2>ğŸš¨ Sorun</h2>
        
        <div class="error">
            <strong>HATA:</strong> Rate limit exceeded - Too many requests. Limit: 1000 requests per hour
            <ul>
                <li>8-10 el sonra bu hata oluÅŸuyor</li>
                <li>Saatte 1000 istek limiti aÅŸÄ±lÄ±yor</li>
                <li>Dakikada ~16 istek demek</li>
            </ul>
        </div>
        
        <div class="warning">
            <strong>Tespit Edilen Sorunlar:</strong>
            <ol>
                <li>Her render'da debouncedSave() Ã§aÄŸrÄ±lÄ±yordu âŒ</li>
                <li>Her 30 saniyede otomatik save âŒ</li>
                <li>Her hamlede anÄ±nda saveGameStateWithMove() âŒ</li>
                <li>Double-click'te ekstra save âŒ</li>
            </ol>
        </div>
    </div>
    
    <div class="card">
        <h2>âœ… YapÄ±lan DÃ¼zeltmeler</h2>
        
        <table>
            <tr>
                <th>Ã–zellik</th>
                <th class="before">Ã–NCEKÄ°</th>
                <th class="after">SONRAKÄ°</th>
            </tr>
            <tr>
                <td>Render'da Save</td>
                <td class="before">Her render'da save âŒ</td>
                <td class="after">KaldÄ±rÄ±ldÄ± âœ…</td>
            </tr>
            <tr>
                <td>Auto-Save</td>
                <td class="before">30 saniye</td>
                <td class="after">60 saniye âœ…</td>
            </tr>
            <tr>
                <td>Save Throttle</td>
                <td class="before">Yok</td>
                <td class="after">500ms throttle âœ…</td>
            </tr>
            <tr>
                <td>Double-Click Save</td>
                <td class="before">AnÄ±nda save</td>
                <td class="after">Debounced save âœ…</td>
            </tr>
            <tr>
                <td>Debounce Timer</td>
                <td class="before">2 saniye</td>
                <td class="after">2 saniye (aynÄ±)</td>
            </tr>
        </table>
        
        <div class="success">
            <strong>SONUÃ‡:</strong> API Ã§aÄŸrÄ±larÄ± %70+ azaltÄ±ldÄ±!
        </div>
    </div>
    
    <div class="card">
        <h2>ğŸ“Š API Ã‡aÄŸrÄ± Analizi</h2>
        
        <div class="code">
// Ã–NCEKÄ° DURUM (1 dakikada):
- Her hamle: 1 save
- Her render: 1 save  
- Auto-save: 2 save (30sn'de bir)
- Toplam: ~30-40 request/dakika âŒ

// YENÄ° DURUM (1 dakikada):
- Hamle grubu: 1 debounced save (2sn sonra)
- Auto-save: 1 save (60sn'de bir)
- Render: 0 save
- Toplam: ~5-10 request/dakika âœ…
        </div>
    </div>
    
    <div class="card">
        <h2>ğŸ”§ Teknik Detaylar</h2>
        
        <div class="code">
// 1. THROTTLE MEKANÄ°ZMASI
let lastSaveTime = 0;
const SAVE_THROTTLE_MS = 500;

function saveGameStateWithMove(moveDetails = null) {
    const now = Date.now();
    if (now - lastSaveTime < SAVE_THROTTLE_MS) {
        debouncedSave(); // Throttled istekler debounce'a yÃ¶nlendirilir
        return;
    }
    lastSaveTime = now;
    // ... save iÅŸlemi
}

// 2. DEBOUNCE MEKANÄ°ZMASI
function debouncedSave() {
    if (saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(saveGameState, 2000); // 2sn sonra save
}

// 3. RENDER'DAN SAVE KALDIRILDI
function render() {
    // Ã–NCEKÄ°:
    // if (typeof debouncedSave !== 'undefined') {
    //     debouncedSave(); âŒ
    // }
    
    // YENÄ°:
    // Save yok, sadece render âœ…
}
        </div>
    </div>
    
    <div class="card">
        <h2>ğŸ§ª Test SenaryolarÄ±</h2>
        
        <ol>
            <li><strong>HÄ±zlÄ± Hamle Testi:</strong> 10 hamleyi hÄ±zlÄ±ca yap â†’ Sadece 1-2 save olmalÄ±</li>
            <li><strong>Uzun Oyun Testi:</strong> 10 el oyna â†’ Rate limit hatasÄ± almamalÄ±sÄ±n</li>
            <li><strong>Console KontrolÃ¼:</strong> "Save throttled" mesajlarÄ±nÄ± gÃ¶r</li>
            <li><strong>Network Tab:</strong> /solitaire/api/save/ Ã§aÄŸrÄ±larÄ±nÄ± say</li>
        </ol>
        
        <div class="warning">
            <strong>Test Ä°pucu:</strong> Chrome DevTools â†’ Network tab'Ä±nÄ± aÃ§ ve API Ã§aÄŸrÄ±larÄ±nÄ± izle
        </div>
    </div>
    
    <div class="card">
        <h2>ğŸ® Teste BaÅŸla</h2>
        
        <button onclick="window.open('http://localhost:8000/solitaire/', '_blank')">
            ğŸƒ Solitaire'i AÃ§
        </button>
        
        <button onclick="showStats()">
            ğŸ“ˆ Ä°statistikleri GÃ¶ster
        </button>
    </div>
    
    <script>
        function showStats() {
            alert(`
RATE LIMIT Ã‡Ã–ZÃœMÃœ:

ğŸ“‰ API Ã‡AÄRI AZALTMA:
â€¢ Render save: %100 azaltÄ±ldÄ± (tamamen kaldÄ±rÄ±ldÄ±)
â€¢ Auto-save: %50 azaltÄ±ldÄ± (30s â†’ 60s)
â€¢ Hamle save: %80 azaltÄ±ldÄ± (throttle + debounce)
â€¢ Double-click: %90 azaltÄ±ldÄ± (debounced)

âš¡ YENÄ° LÄ°MÄ°TLER:
â€¢ Min 500ms between saves (throttle)
â€¢ 2 saniye inaktivite sonrasÄ± save (debounce)
â€¢ 60 saniyede bir auto-save
â€¢ Saatte max ~600 request (limit: 1000)

âœ… SONUÃ‡:
10+ el oynanabilir, rate limit hatasÄ± yok!
            `);
        }
    </script>
</body>
</html>